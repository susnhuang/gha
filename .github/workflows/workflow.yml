name: Branch-specific Python Script

on:
  push:
    # Specify the branches this workflow should run on
    branches:
      - 'feature/**' # Wildcard pattern for feature branches
  workflow_dispatch:
    inputs:
      VS_USERNAME:
        description: 'VS username'
        required: false
        type: string
      VS_PASSWORD:
        description: 'VS password'
        required: false
        type: string
      EXT_1:
        description: 'An example input parameter'
        required: false
        default: '10.11.120.12'
        type: string
      INT_A:
        description: 'An integer input parameter'
        required: false
        default: '10.11.120.121'
        type: string
      INT_B:
        description: 'An integer input parameter'
        required: false
        default: '10.11.120.221'
        type: string
      DNODE_USERNAME:
        description: 'DNode username'
        required: false
        type: string
      DNODE_PASSWORD:
        description: 'DNode password'
        required: false
        type: string

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # Specify your required Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          python -m pip install tox
          # Add any other pip install commands here

      - name: Execute Python script with branch name env var
        # The GITHUB_REF_NAME variable is automatically available as an environment variable
        run: python src/test.py
        env:
          CNODE_USERNAME: ${{ vars.CNODE_USERNAME }}
          CNODE_PASSWORD: ${{ secrets.CNODE_PASSWORD }}
          JNODE_USERNAME: ${{ vars.JNODE_USERNAME }}
          JNODE_PASSWORD: ${{ secrets.JNODE_PASSWORD }}
          DEFAULT_EXT_1: "default_ext_1"
          BRANCH_NAME: ${{ github.ref_name }} # Pass the branch name context as an environment variable
      - name: Upload log file as artifact
        uses: actions/upload-artifact@v4
        with:
          name: python-script-logs
          path: app.log